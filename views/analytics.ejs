<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analytics - Inventory Application</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&family=Roboto+Mono:ital,wght@0,100..700;1,100..700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/styles/style.css" />
  </head>
  <body class="bg-bg min-h-dvh flex flex-col text-white">
    <%- include("partials/header"); %>
    <main class="flex flex-col grow mt-20 sm:mt-0 p-5">
      <div class="max-w-7xl mx-auto w-full">
        <h1 class="font-script text-3xl font-bold text-white mb-5 select-none">Analytics Dashboard</h1>
        
        <!-- Filter Section -->
        <div class="mb-5 flex flex-wrap gap-3">
          <a href="/analytics" class="font-mono font-bold border-2 <%= filterAction === 'all' ? 'bg-accent text-black border-accent' : 'border-accent text-accent' %> rounded-xl px-5 py-2 hover:scale-105 hover:shadow-md hover:shadow-accent">All Actions</a>
          <a href="/analytics?action=page_view" class="font-mono font-bold border-2 <%= filterAction === 'page_view' ? 'bg-accent text-black border-accent' : 'border-accent text-accent' %> rounded-xl px-5 py-2 hover:scale-105 hover:shadow-md hover:shadow-accent">Page Views</a>
          <a href="/analytics?action=button_click" class="font-mono font-bold border-2 <%= filterAction === 'button_click' ? 'bg-accent text-black border-accent' : 'border-accent text-accent' %> rounded-xl px-5 py-2 hover:scale-105 hover:shadow-md hover:shadow-accent">Button Clicks</a>
          <a href="/analytics?action=form_submit" class="font-mono font-bold border-2 <%= filterAction === 'form_submit' ? 'bg-accent text-black border-accent' : 'border-accent text-accent' %> rounded-xl px-5 py-2 hover:scale-105 hover:shadow-md hover:shadow-accent">Form Submits</a>
        </div>

        <!-- Analytics Table -->
        <div class="bg-secondary rounded-lg overflow-hidden shadow-lg">
          <div class="overflow-x-auto">
            <table class="w-full font-mono text-sm">
              <thead class="bg-accent text-black">
                <tr>
                  <th class="px-4 py-3 text-left">ID</th>
                  <th class="px-4 py-3 text-left">Action</th>
                  <th class="px-4 py-3 text-left">Page URL</th>
                  <th class="px-4 py-3 text-left">User Agent</th>
                  <th class="px-4 py-3 text-left">IP Address</th>
                  <th class="px-4 py-3 text-left">Timestamp</th>
                </tr>
              </thead>
              <tbody>
                <% if(analytics.length === 0) { %>
                  <tr>
                    <td colspan="6" class="px-4 py-8 text-center text-accent">No analytics data available</td>
                  </tr>
                <% } else { %>
                  <% analytics.forEach(analytic => { %>
                    <tr class="border-b border-bg hover:bg-bg transition-colors">
                      <td class="px-4 py-3"><%= analytic.id %></td>
                      <td class="px-4 py-3 text-accent font-bold"><%= analytic.action %></td>
                      <td class="px-4 py-3 truncate max-w-xs"><%= analytic.page_url %></td>
                      <td class="px-4 py-3 truncate max-w-xs text-xs"><%= analytic.user_agent %></td>
                      <td class="px-4 py-3"><%= analytic.ip_address %></td>
                      <td class="px-4 py-3"><%= new Date(analytic.timestamp).toLocaleString() %></td>
                    </tr>
                  <% }); %>
                <% } %>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Back Button -->
        <div class="mt-5">
          <a href="/" class="font-mono font-bold border-2 border-accent text-accent rounded-xl px-5 py-2 inline-block hover:scale-105 hover:shadow-md hover:shadow-accent">Back to Home</a>
        </div>
      </div>
    </main>

    <!-- Analytics Tracking Script -->
    <script>
      // Function to track interactions
      function trackInteraction(action, details = '') {
        fetch('/analytics/track', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ action, details }),
        }).catch(err => console.error('Error tracking interaction:', err));
      }

      // Track button clicks
      document.addEventListener('click', function(e) {
        if (e.target.tagName === 'A' || e.target.tagName === 'BUTTON') {
          const text = e.target.textContent.trim().substring(0, 50);
          trackInteraction('button_click', text);
        }
      });

      // Track form submissions
      document.addEventListener('submit', function(e) {
        const formAction = e.target.action || 'unknown';
        trackInteraction('form_submit', formAction);
      });
    </script>
  </body>
</html>
